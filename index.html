<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Devilswahn's Bootlegs</title>

<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;600&family=Roboto:wght@300;400&display=swap" rel="stylesheet">

<style>
:root {
  --red:#b00000;
  --border:#400;
  --bg:#000;
}

body {
  margin:0;
  font-family:Roboto,Arial,sans-serif;
  background:radial-gradient(circle at top,#300 0%,#000 65%);
  color:#ddd;
}

.container {
  max-width:960px;
  margin:40px auto;
  background:#0b0b0b;
  border:1px solid var(--border);
  box-shadow:0 0 40px rgba(255,0,0,.35);
}

header {
  text-align:center;
  padding:25px;
  border-bottom:2px solid var(--red);
}

header h1 {
  margin:0;
  font-family:Oswald,sans-serif;
  letter-spacing:4px;
  color:#f33;
}

/* TABS */
.tabs {
  display:flex;
  gap:6px;
  padding:12px;
  border-bottom:1px solid var(--border);
}

.tabs button {
  background:#160000;
  color:#bbb;
  border:1px solid var(--border);
  padding:8px 16px;
  font-family:Oswald,sans-serif;
  letter-spacing:1px;
  cursor:pointer;
}

.tabs button.active {
  background:var(--red);
  color:#fff;
  border-color:#f00;
}

/* HEADER ROW */
.topbar {
  display:flex;
  gap:10px;
  padding:15px 20px 0;
}

.topbar input {
  flex:1;
  padding:8px;
  background:#000;
  border:1px solid var(--border);
  color:#fff;
}

.topbar button {
  padding:8px 14px;
  background:#300;
  border:1px solid #800;
  color:#fff;
  cursor:pointer;
  font-family:Oswald,sans-serif;
}

.topbar button:hover {
  background:#600;
}

h3 {
  margin:20px;
  font-family:Oswald,sans-serif;
  letter-spacing:2px;
  color:#f33;
}

/* INDEX */
.index {
  margin:10px 20px;
  text-align:center;
}

.index span {
  margin:4px;
  padding:4px 7px;
  border:1px solid var(--border);
  cursor:pointer;
  display:inline-block;
  font-family:Oswald,sans-serif;
}

.index span:hover {
  background:var(--red);
}

/* CONTENT */
#content {
  padding:0 20px 30px;
}

.artist {
  margin-top:28px;
  font-family:Oswald,sans-serif;
  font-size:18px;
  border-bottom:1px solid var(--border);
}

.bootleg {
  margin-left:18px;
  display:block;
  color:#ccc;
}

.bootleg::before {
  content:"â–¸ ";
  color:#f33;
}
</style>
</head>

<body>

<div class="container">

<header>
  <h1>DEVILSWAHN'S BOOTLEGS</h1>
</header>

<div class="tabs">
  <button onclick="showTab('new',this)">New Shit</button>
  <button onclick="showTab('audio',this)">Audio</button>
  <button class="active" onclick="showTab('video',this)">Video</button>
  <button onclick="showTab('links',this)">Links</button>
  <button onclick="showTab('contact',this)">Contact</button>
</div>

<h3 id="tab-title">Video</h3>

<div class="topbar">
  <input id="search" placeholder="Filter artist or title">
  <button onclick="exportTxt()">Export TXT</button>
</div>

<div class="index" id="az"></div>
<div id="content"></div>

</div>

<script>
const sources={
  audio:"https://docs.google.com/spreadsheets/d/1rxEFXEDSxOCUVUpEq1mqhlknVP19X-Wwt5K-jOOjkqU/export?format=csv&gid=0",
  video:"https://docs.google.com/spreadsheets/d/1rxEFXEDSxOCUVUpEq1mqhlknVP19X-Wwt5K-jOOjkqU/export?format=csv&gid=1495617644"
};

let currentTab="video";
let fullData={};

function showTab(tab,btn){
  currentTab=tab;
  document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  document.getElementById("tab-title").textContent=tab.toUpperCase();
  document.getElementById("search").value="";
  if(sources[tab]) loadCsv(sources[tab]);
  else document.getElementById("content").innerHTML="<p>Coming soon.</p>";
}

function loadCsv(url){
  fetch(url).then(r=>r.text()).then(csv=>{
    const rows=csv.split(/\r?\n/).slice(1);
    fullData={};
    rows.forEach(r=>{
      const c=r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(x=>x.replace(/"/g,"").trim());
      if(!c[0])return;
      const artist=c[0];
      const item=c.find((x,i)=>i>0&&x);
      if(!item)return;
      (fullData[artist]??=[]).push(item);
    });
    render(fullData);
  });
}

function render(data){
  const c=document.getElementById("content");
  const az=document.getElementById("az");
  c.innerHTML="";az.innerHTML="";
  let cur="";
  Object.keys(data).sort((a,b)=>a.localeCompare(b)).forEach(a=>{
    const l=a[0].toUpperCase();
    if(l!==cur){
      cur=l;
      const s=document.createElement("span");
      s.textContent=l;
      s.onclick=()=>document.getElementById("a"+l).scrollIntoView();
      az.appendChild(s);
      const d=document.createElement("div");
      d.id="a"+l;
      c.appendChild(d);
    }
    const ad=document.createElement("div");
    ad.className="artist";
    ad.textContent=a;
    c.appendChild(ad);
    data[a].forEach(t=>{
      const b=document.createElement("span");
      b.className="bootleg";
      b.textContent=t;
      c.appendChild(b);
    });
  });
}

document.getElementById("search").addEventListener("input",e=>{
  const q=e.target.value.toLowerCase();
  const f={};
  for(const a in fullData){
    const h=fullData[a].filter(v=>a.toLowerCase().includes(q)||v.toLowerCase().includes(q));
    if(h.length)f[a]=h;
  }
  render(f);
});

function exportTxt(){
  let txt="DEVILSWAHN'S BOOTLEGS\n"+currentTab.toUpperCase()+"\n===================\n\n";
  const data=document.getElementById("search").value?(()=>{const r={};for(const a in fullData){const h=fullData[a].filter(v=>a.toLowerCase().includes(search.value)||v.toLowerCase().includes(search.value));if(h.length)r[a]=h;}return r;})():fullData;
  Object.keys(data).sort().forEach(a=>{
    txt+=a+"\n";
    data[a].forEach(v=>txt+="  - "+v+"\n");
    txt+="\n";
  });
  const blob=new Blob([txt],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="devilswahn-"+currentTab+".txt";
  a.click();
}

loadCsv(sources.video);
</script>

</body>
</html>
